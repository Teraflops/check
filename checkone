import org.apache.spark.sql.{DataFrame, SparkSession}
import org.apache.spark.sql.expressions.Window
import org.apache.spark.sql.functions._

val spark: SparkSession = SparkSession.builder().getOrCreate()

def dateToEpochMs(cols: Seq[String], df: DataFrame): DataFrame =
  cols.foldLeft(df) { (d, c) =>
    // unix_timestamp = seconds, so multiply by 1000 to get epoch millis
    d.withColumn(c, (unix_timestamp(to_timestamp(col(c))) * 1000L).cast("long"))
  }

// Columns you had in Python
val dateList = Seq("LstStmtDt", "StmtEntDt", "LstUpdDt", "AcctOpnDt")

// Equivalent of: row_number() over(partition by acct_id, clnt_id order by etl_load_dt desc) as rank
val w = Window.partitionBy(col("acct_id"), col("clnt_id")).orderBy(col("etl_load_dt").desc)

val accountScpnBase =
  spark.table("NEXTGEN_CB.ACCOUNT_SCPN")
    .withColumn("rank", row_number().over(w))
    .filter(col("rank") === 1)
    .drop("rank")

// If you want to replicate the long .withColumnRenamed(...) chain, do it via a map:
val renamePairs: Seq[(String, String)] = Seq(
  // Examples from your screenshot (add the rest of your renames here)
  ("BR_NAM", "BrNm"),
  ("CLNT_NAM", "ClntNm"),
  ("CLNT_ID", "ClntId"),
  ("ACCT_ID", "AcctId")
  // ... continue for all other withColumnRenamed pairs ...
)

def applyRenames(df: DataFrame, pairs: Seq[(String, String)]): DataFrame =
  pairs.foldLeft(df) { case (d, (from, to)) => d.withColumnRenamed(from, to) }

val accountScpn =
  applyRenames(accountScpnBase, renamePairs)
    // Python had current_timestamp()*1000; unix_timestamp(current_timestamp()) gives seconds
    .withColumn("current_timestamp", (unix_timestamp(current_timestamp()) * 1000L).cast("long"))
    // add other columns/drops from your script here, e.g.:
    // .withColumn("UpdUsr", lit("admin"))
    // .drop("etl_batch_id", "etl_bi_id", "etl_uuid", "etl_load_dt")
    ;

// Convert selected date columns to epoch millis and write parquet (overwrite)
dateToEpochMs(dateList, accountScpn)
  .write
  .mode("overwrite")
  .parquet("/data/ttsbdcmds/raw/hive/NEXTGEN_CB/PROD/CD_ACCOUNT_SCPN")
